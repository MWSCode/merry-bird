// Merri-Bird v.1 (c) Mamali-Workshop 12-2024
function $(e,s){return"."==s?document.getElementsByClassName(e):document.getElementById(e)}let game_window=$("game_window");var bird_div=$("bird"),positionXY=$("coordinates"),obstacle_div=$("obstacle"),test_div=$("test"),score_span=$("score");let final_score_spans=$("final_score",".");var collisionCount_div=$("collisionCount"),hearts_span=$("hearts"),hearts_span2=$("hearts2"),walls_spans=$("walls",".");let message_box=$("message_box"),message_windows=$("message_window","."),start_message=$("start_message"),won_message=$("won_message"),hit_message=$("hit_message"),gameOver_message=$("gameOver_message"),sound_crash=$("crash"),sound_music=$("music"),sound_music2=$("music_2");var collision_soundPlayed=0;let lastFrameCollision=0,button_event=null,music_speed=1,score=0;const allowedKeys=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];function initial_values(){score_span.innerHTML="0",score=0,obstacle.speed=2,obstacle.topBottom=0,obstacle.passed=0,obstacle.height=20,obstacle.y=0,obstacle.right=0,obstacle.total_count=15,bird.hearts=3,music_speed=1}let animationInverval=null,animation={speed:1,frame_duration:15,start(){animationInverval=setInterval(animation_loop_func,this.frame_duration)},stop(){clearInterval(animationInverval)}},obstacle={x:obstacle_div.offsetLeft,y:obstacle_div.offsetTop,width:obstacle_div.offsetWidth,height:obstacle_div.offsetHeight,right:1,total_count:5,passed:0,speed:2,topBottom:1},bird={x:bird_div.offsetLeft,y:bird_div.offsetTop,width:bird_div.offsetWidth,height:bird_div.offsetHeight,hearts:5};var elem=$("body_fc");function openFullscreen(){elem.requestFullscreen?elem.requestFullscreen():elem.webkitRequestFullscreen?elem.webkitRequestFullscreen():elem.msRequestFullscreen&&elem.msRequestFullscreen()}function start_game(){message_box.style.display="none",initial_values(),obstacle_div.style.height=obstacle.height+"%",obstacle_div.style.right=0,obstacle_div.style.top=0,button_event=null,animation.start(),sound_music.currentTime=0,sound_music2.currentTime=0,sound_music.play(),bird_div.style.left="50px",bird_div.style.top="calc(50% - 20px)",bird.x=bird_div.offsetLeft,bird.y=bird_div.offsetTop}function game_won_message(){animation.stop();for(let e of final_score_spans)e.innerHTML=score;message_box.style.display="flex";for(let e of message_windows)e.style.display="none";won_message.style.display="block",sound_music.pause(),sound_music.currentTime=0,sound_music2.pause(),sound_music2.currentTime=0}function crashed_message(){stopFire(),message_box.style.display="flex";for(let e of message_windows)e.style.display="none";hit_message.style.display="block"}function continue_game(){obstacle.right=0,obstacle_div.style.right=0,obstacle.y=0,obstacle_div.style.top=0,obstacle_div.style.height="15%",message_box.style.display="none",animation.start(),1==music_speed?(sound_music.currentTime=0,sound_music.play()):2==music_speed&&(sound_music2.currentTime=0,sound_music2.play()),bird_div.style.left="30px",bird_div.style.top="calc(50% - 20px)",bird.x=bird_div.offsetLeft,bird.y=bird_div.offsetTop}function game_over_message(){animation.stop();for(let e of final_score_spans)e.innerHTML=score;message_box.style.display="flex";for(let e of message_windows)e.style.display="none";gameOver_message.style.display="block"}let key_pressed="";function key_event(e){key_pressed=e.key}function key_released(e){key_pressed=""}function move(e){let s=parseInt(bird_div.offsetTop),t=parseInt(bird_div.offsetLeft);switch(e){case"up":s-=8;break;case"down":s+=8;break;case"left":t-=8;break;case"right":t+=8;break;default:alert("Not a valid input")}bird_div.style.top=s+"px",bird_div.style.left=t+"px"}document.addEventListener("keydown",key_event),document.addEventListener("keyup",key_released);const control_buttons=document.querySelectorAll("#buttons button");let mouseFireTimeout=null;function stopFire(){button_event=null}document.addEventListener("DOMContentLoaded",(function(){function e(e){button_event=e}for(let s of control_buttons)s.addEventListener("mousedown",e),s.addEventListener("mouseup",stopFire),s.addEventListener("touchstart",e),s.addEventListener("touchend",stopFire)}));let window_width=null,window_height=null;function get_window_dimensions(){window_width=getComputedStyle(game_window).width,window_width=Number(window_width.slice(0,-2)),window_height=getComputedStyle(game_window).height,window_height=Number(window_height.slice(0,-2))}get_window_dimensions();let resize_observer=new ResizeObserver(get_window_dimensions).observe(game_window),time_passed=0,ms_passed=0,time_1=0;function animation_loop_func(){if(obstacle.x=obstacle_div.offsetLeft,obstacle.y=obstacle_div.offsetTop,obstacle.width=obstacle_div.offsetWidth,obstacle.height=obstacle_div.offsetHeight,""!=key_pressed&&allowedKeys.includes(key_pressed))switch(key_pressed){case"ArrowUp":move("up");break;case"ArrowDown":move("down");break;case"ArrowLeft":move("left");break;case"ArrowRight":move("right")}if(null!=button_event){move(button_event.target.getAttribute("data-direction"))}if(hearts_span.innerHTML=bird.hearts,bird.x=bird_div.offsetLeft,bird.y=bird_div.offsetTop,bird.x<=0&&(bird_div.style.left=0,test_div.innerHTML="left"),bird.y<=0&&(bird_div.style.top=0,test_div.innerHTML="bala"),bird.x+bird.width>=window_width&&(bird_div.style.left=window_width-bird.width+"px",test_div.innerHTML="right"),bird.y+bird.height>=window_height&&(bird_div.style.top=window_height-bird.height+"px",test_div.innerHTML="bottom"),obstacle.right=obstacle.right+obstacle.speed+obstacle.passed,obstacle_div.style.right=obstacle.right+"px",obstacle.right-20>window_width){obstacle.right=0,obstacle.passed++,window_height=Math.ceil(window_height);let e=Math.floor(window_height-(bird.height+window_height/10)),s=Math.floor(window_height/5);obstacle.height=Math.floor(Math.random()*(e-s))+s,1==obstacle.topBottom?obstacle.y=0:obstacle.y=window_height-obstacle.height,obstacle.topBottom=Math.round(Math.random()),obstacle_div.style.top=obstacle.y+"px",obstacle_div.style.height=obstacle.height+"px",score=obstacle.passed*bird.hearts,score_span.innerHTML=score}obstacle.passed>=10&&(music_speed=2,sound_music.playbackRate=1,sound_music.pause(),sound_music.currentTime=0,sound_music2.play()),obstacle.passed>5&&obstacle.passed<10&&(music_speed=1,sound_music.playbackRate=2,sound_music.play(),sound_music2.pause(),sound_music2.currentTime=0),obstacle.passed>=0&&obstacle.passed<=5&&(music_speed=1,sound_music.playbackRate=1,sound_music.play());for(let e of walls_spans)e.innerHTML=obstacle.passed;1==collision(bird,obstacle)?(0==lastFrameCollision&&(bird_div.style.background="url('assets/images/merry-bird-crash.gif')",sound_crash.paused&&!collision_soundPlayed&&(sound_crash.play(),collision_soundPlayed=1),animation.stop(),sound_music.pause(),sound_music.currentTime=0,sound_music2.pause(),sound_music2.currentTime=0,bird.hearts--,obstacle.speed++,hearts_span.innerHTML=bird.hearts,hearts_span2.innerHTML=bird.hearts,crashed_message()),lastFrameCollision=1):(bird_div.style.background='url("assets/images/merry-bird.gif")',collision_soundPlayed=0,lastFrameCollision=0),obstacle.passed==obstacle.total_count&&game_won_message(),bird.hearts<=0&&game_over_message()}function collision(e,s){let t=e.y+10,i=e.x+10,o=e.height-20,a=e.width-20;return!(t+o<s.y||t>s.y+s.height||i+a<s.x||i>s.x+s.width)}
